{
  "meta": {},
  "items": [
    {
      "itemID": "000",
      "menu_item": null,
      "contenido": "VIDEO DE YOUTUBE:\n(Referencia visual del tutorial)\n\"Learn Fast API With This ONE Project \"\nhttps://youtu.be/SR5NYCdzKkc?si=TxYIKMQ4F2Sw8tvP"
    },
    {
      "itemID": "001",
      "menu_item": "REQUISITOS Y OBJETIVO DEL PROYECTO API",
      "contenido": "**Apps Script es una plataforma de desarrollo rápido de aplicaciones que se integra con Google Workspace, utilizando JavaScript moderno**.\n\n**Requisitos previos**\n\n*   **NAVEGADOR:** Una Cuenta de Google con acceso a Google Sheets y Google Apps Script.\n*   **TERMINAL:** Se usará la Terminal de Windows solo para verificar las solicitudes de escritura (POST) mediante la herramienta `curl` (opcional, pero recomendado para pruebas completas de API).\n\n**Objetivo final**\nConstruir y desplegar una **Aplicación Web (Web App)** que funcione como una API REST completa (GET/POST) y que pueda leer y modificar datos de una Hoja de cálculo de Google, sirviendo los resultados en formato JSON.\n\n**Criterio de éxito**\nObtener una URL pública de la Web App (`.../exec`) que devuelva los datos de la hoja de cálculo en formato JSON (lectura) y que permita crear, actualizar o eliminar registros (escritura) mediante solicitudes HTTP."
    },
    {
      "itemID": "002",
      "menu_item": "PASO 1: Configuración de la \"Base de Datos\" (Google Sheet)",
      "contenido": "**Explicación:**\nPara construir nuestra API, Google Sheets actuará como la base de datos de fácil edición. Debemos crear una estructura con encabezados específicos que el código de Apps Script usará para mapear los datos y realizar operaciones (CRUD).\n\n**Validación con Apps Script:**\nEl servicio `SpreadsheetApp` dentro de Google Apps Script es la biblioteca incorporada que permite a tu código acceder y manipular los datos en la hoja de cálculo de Google de forma programática.\n\n**Acción (NAVEGADOR):**\n1.  **Crea una nueva Hoja de cálculo de Google.**\n2.  **Renombra la primera pestaña** como 'Tutoriales'.\n3.  En la fila 1 (la fila de encabezados), introduce exactamente las siguientes columnas, separadas por la barra vertical (`|`):\n    **RecordID | Titulo | URL | Etiqueta | Sinopsis**\n4.  Añade al menos una fila de datos de prueba (por ejemplo: TUT001 | Título Prueba | http://ejemplo.com | ETQ001 | Sinopsis de prueba).\n\n**Prueba para ver si funcionó correctamente:**\nLa hoja debe tener la pestaña 'Tutoriales' y las cinco columnas listadas en la primera fila para que el *backend* de Apps Script las reconozca."
    },
    {
      "itemID": "003",
      "menu_item": "PASO 2: Inicialización de Apps Script y Funciones Base",
      "contenido": "**Explicación:**\nAccede al editor de Apps Script (el *backend serverless*) e incluye las funciones esenciales que permiten al script leer los datos de la hoja y formatear las respuestas como JSON.\n\n**Validación con Apps Script:**\nApps Script es una plataforma de JavaScript que se ejecuta en la nube. El editor de código te permite escribir funciones para automatizar tareas en Google Workspace.\n\n**Acción (NAVEGADOR):**\n1.  En tu Hoja de cálculo de Google, ve a **Extensiones > Apps Script**. Esto abrirá el editor de código.\n2.  Renombra el archivo `Código.gs` a `Code.gs`.\n3.  Copia las siguientes funciones de utilidades y pegalas en `Code.gs`. Estas funciones son cruciales para:\n    *   Acceder a la hoja activa (`sh()`).\n    *   Mapear los encabezados de las columnas (`idxMap()`).\n    *   Leer todas las filas de datos como objetos JSON (`allRows()`).\n    *   Formatear la respuesta como JSON para la API (`out()`).\n\n```javascript\n// Variables y utilidades básicas\nvar SHEET_NAME = (typeof SHEET_NAME === 'undefined') ? 'Tutoriales' : SHEET_NAME;\n\nfunction sh(){ return SpreadsheetApp.getActive().getSheetByName(SHEET_NAME); }\n\nfunction headers(){ return sh().getRange(1,1,1,sh().getLastColumn()).getValues(); } // Corregido: h.forEach((k,i)=>m[k]=i) necesita  en getValues().\n\nfunction idxMap(){ const h=headers(), m={}; h.forEach((k,i)=>m[k]=i); return m; }\n\nfunction allRows(){\nconst s=sh(), vals=s.getRange(2,1,Math.max(s.getLastRow()-1,0), s.getLastColumn()).getValues();\nconst m=idxMap();\nreturn vals.filter(r=>r.join('')!=='').map(r=>({\nid: r[m['RecordID']], title: r[m['Titulo']], url: r[m['URL']],\ntag: r[m['Etiqueta']], synopsis: r[m['Sinopsis']]\n}));\n}\n\nfunction out(obj){\n// Usa ContentService para devolver datos como JSON\nreturn ContentService.createTextOutput(JSON.stringify(obj))\n.setMimeType(ContentService.MimeType.JSON);\n}\n```\n4.  Guarda el proyecto (haciendo clic en el icono del disquete).\n\n**Prueba para ver si funcionó correctamente:**\nAunque estas funciones aún no son accesibles externamente, la función `out(obj)` utiliza la clase `ContentService` para devolver datos en formato JSON, asegurando que la API cumpla con el estándar JSON."
    },
    {
      "itemID": "004",
      "menu_item": "PASO 3: Implementación del Backend REST (Funciones GET y POST)",
      "contenido": "**Explicación:**\nEl núcleo de cualquier API REST en Apps Script son las funciones de servicio HTTP: `doGet(e)` y `doPost(e)`.\n\n*   **`doGet(e)`** maneja las solicitudes de lectura (GET), permitiendo listar o buscar registros.\n*   **`doPost(e)`** maneja las solicitudes de escritura (POST), permitiendo crear, actualizar o eliminar registros.\n\n**Validación con Apps Script:**\nAl publicar un script como Aplicación Web, este genera un *endpoint* público (`.../exec`) que utiliza las funciones estándar `doGet(e)` y `doPost(e)` para procesar las solicitudes HTTP entrantes de lectura y escritura.\n\n**Acción (NAVEGADOR):**\n1.  Añade las siguientes funciones a continuación del código existente en `Code.gs`:\n\n```javascript\n// API REST — Read (GET)\nfunction doGet(e){\nconst p = e?.parameter || {};\nconst action = (p.action||'list').toLowerCase();\n\nif(action==='list'){\nconst q=(p.q||'').toLowerCase(), tag=p.tag, withUrl=p.withUrl;\nconst tags = Array.isArray(tag)? tag : (tag? [tag]:[]);\nconst rows = allRows().filter(r=>{\nconst txt=(String(r.title)+' '+String(r.synopsis||'')).toLowerCase();\nif(q && !txt.includes(q)) return false;\nif(tags.length && !tags.includes(r.tag||'')) return false;\nif(withUrl==='yes' && !r.url) return false;\nif(withUrl==='no' && r.url) return false;\nreturn true;\n});\nreturn out(rows);\n}\n\nif(action==='get'){\nconst id=p.id; if(!id) return out({error:'missing id'});\nconst row = allRows().find(r=>String(r.id)===String(id));\nreturn out(row || {});\n}\n\nreturn out({error:'unknown action'});\n}\n\n\n// API REST — Write (POST)\nfunction doPost(e){\nconst body = e?.postData?.contents ? JSON.parse(e.postData.contents) : {};\nconst action = (body.action||'').toLowerCase();\nconst data = body.data||{};\nconst s=sh(), m=idxMap();\n\nif(action==='create'){\nif(!data.id) return out({error:'missing id'});\ns.appendRow([data.id||'', data.title||'', data.url||'', data.tag||'', data.synopsis||'']);\nreturn out({ok:true, id:data.id});\n}\n\nif(action==='update'){\nif(!data.id) return out({error:'missing id'});\nconst vals = s.getRange(2,1,Math.max(s.getLastRow()-1,0), s.getLastColumn()).getValues();\nconst rIndex = vals.findIndex(r=>String(r[m['RecordID']])===String(data.id));\nif(rIndex<0) return out({error:'not found'});\nconst rowNum = rIndex+2;\nif(data.title!==undefined) s.getRange(rowNum, m['Titulo']+1).setValue(data.title);\nif(data.url!==undefined) s.getRange(rowNum, m['URL']+1).setValue(data.url);\nif(data.tag!==undefined) s.getRange(rowNum, m['Etiqueta']+1).setValue(data.tag);\nif(data.synopsis!==undefined)s.getRange(rowNum, m['Sinopsis']+1).setValue(data.synopsis);\nreturn out({ok:true, id:data.id});\n}\n\nif(action==='delete'){\nif(!data.id) return out({error:'missing id'});\nconst vals = s.getRange(2,1,Math.max(s.getLastRow()-1,0), s.getLastColumn()).getValues();\nconst rIndex = vals.findIndex(r=>String(r[m['RecordID']])===String(data.id));\nif(rIndex<0) return out({error:'not found'});\ns.deleteRow(rIndex+2);\nreturn out({ok:true, id:data.id});\n}\n\nreturn out({error:'unknown action'});\n}\n\nfunction doOptions(e){ return out({ok:true}); }\n```\n\n2.  Guarda el proyecto.\n\n**Prueba para ver si funcionó correctamente:**\nLas funciones `doGet` y `doPost` están ahora definidas. Al implementarlas como Aplicación Web, se convertirán en los *endpoints* de lectura y escritura de tu API, cumpliendo con las capacidades de la plataforma para extender y automatizar Google Workspace."
    },
    {
      "itemID": "005",
      "menu_item": "PASO 4: Despliegue como Aplicación Web y Obtención de la URL",
      "contenido": "**Explicación:**\nPara que las funciones `doGet` y `doPost` puedan recibir peticiones de cualquier servicio externo (como un cliente FastAPI o una aplicación web), el script debe publicarse como una Aplicación Web (Web App). Esto genera la URL pública de tu API REST.\n\n**Validación con Apps Script:**\nApps Script permite a los desarrolladores publicar scripts como Aplicaciones Web. Este proceso es clave para exponer los servicios `doGet` y `doPost` como *endpoints* accesibles mediante llamadas HTTP.\n\n**Acción (NAVEGADOR):**\n1.  En el editor de Apps Script, haz clic en **Implementar > Nueva implementación**.\n2.  Si es la primera vez, el sistema te pedirá autorización, ya que el script está programado para automatizar y extender Google Workspace (lo cual es una función fundamental de Apps Script).\n3.  Selecciona **Aplicación web** como tipo de implementación.\n4.  Configura:\n    *   'Ejecutar como': **Yo** (tu cuenta).\n    *   'Acceso': **Cualquiera con el vínculo** (para que la API sea pública).\n5.  Haz clic en **Implementar**.\n6.  **Copia la URL de la aplicación web** (debería tener el formato `.../exec`). **Guarda esta URL**, es el *endpoint* base de tu API.\n\n**Prueba para ver si funcionó correctamente:**\nDebes obtener una URL de implementación única."
    },
    {
      "itemID": "006",
      "menu_item": "PASO 5: Verificación Funcional del Endpoint (CRUD)",
      "contenido": "**Explicación:**\nAhora que tienes la URL pública, puedes probar las funcionalidades GET (lectura) y POST (creación, actualización, eliminación) para confirmar que tu Google Sheet está operando como una API REST.\n\n**Validación con Apps Script:**\nLas solicitudes GET enviadas a la URL de la Aplicación Web son manejadas por la función `doGet(e)`, la cual devuelve la respuesta en formato JSON mediante `ContentService`.\n\n**Prueba 1: Lectura de datos (GET)**\n\n*   **Comando en TERMINAL/Acción en NAVEGADOR:**\n    Pega tu URL pública (`.../exec`) directamente en una nueva pestaña del navegador.\n*   **Prueba para ver si funcionó correctamente:**\n    Deberías ver los datos de tu hoja de cálculo (incluyendo el registro de prueba TUT001) devueltos en formato JSON en el navegador. Por ejemplo: `[{\"id\":\"TUT001\", \"title\":\"Título Prueba\", ...}]`.\n\n**Prueba 2: Creación de un registro (POST)**\n\n*   **Comando en TERMINAL:**\n    Utiliza el siguiente comando `curl` en la Terminal de Windows, reemplazando `[Tu URL]/exec` con la URL de tu implementación:\n\n    ```\n    curl -X POST \"[Tu URL]/exec\" -H \"Content-Type: application/json\" -d \"{\\\"action\\\":\\\"create\\\",\\\"data\\\":{\\\"id\\\":\\\"TUT999\\\",\\\"title\\\":\\\"Nuevo API Project\\\",\\\"tag\\\":\\\"ETQ002\\\",\\\"synopsis\\\":\\\"Texto de prueba\\\"}}\"\n    ```\n\n*   **Acción:** Ejecuta el comando.\n*   **Prueba para ver si funcionó correctamente:**\n    1. La Terminal debe devolver una respuesta JSON indicando éxito, como `{\"ok\":true, \"id\":\"TUT999\"}`.\n    2. Abre tu hoja de cálculo 'Tutoriales'. Debe haber aparecido una **nueva fila** con el RecordID \"TUT999\", confirmando que la función `doPost(e)` y la acción `create` funcionaron correctamente."
    },
    {
      "itemID": "007",
      "menu_item": "VALIDACIÓN CON FUENTES TÉCNICAS OFICIALES",
      "contenido": "El desarrollo de esta API (SheetREST) se basa en el uso exclusivo de las herramientas nativas de Google, una práctica ampliamente documentada en las fuentes de Google Apps Script.\n\n**1. Apps Script como Backend Serverless:**\nApps Script es una plataforma de JavaScript basada en la nube, con la tecnología de Google Drive, que se utiliza para integrar y automatizar tareas en los productos de Google.\n\n**2. Integración con Google Sheets (Base de Datos):**\nEl motor que permite al código interactuar con los datos de la hoja es el servicio incorporado `SpreadsheetApp`. Las funciones de la API acceden a la hoja programáticamente para realizar operaciones.\n\n**3. Creación de Endpoints REST (Web Apps):**\nApps Script permite publicar scripts como **Aplicaciones Web** (Web apps). Este tipo de implementación genera un *endpoint* público (`.../exec`) que es capaz de manejar peticiones HTTP. Las funciones estándar `doGet(e)` y `doPost(e)` son utilizadas para procesar las solicitudes de lectura y escritura, respectivamente, formando el núcleo de la API REST.\n\n**4. Respuestas en Formato JSON:**\nPara garantizar que la salida de la API sea un formato estándar, se utiliza el servicio de utilidad `ContentService`. El código emplea específicamente el método `ContentService.createTextOutput().setMimeType(ContentService.MimeType.JSON)` para asegurar que los datos se devuelvan en formato JSON.\n\n**Referencias de la Documentación Oficial de Google:**\n\n*   **Descripción general de Apps Script:** Automatiza y extiende Google Workspace con código sencillo.\n*   **Servicios de Google Workspace (SpreadsheetApp):** Acceso a Hojas de cálculo.\n*   **Servicios de utilidad (ContentService):** Generación de salida JSON.\n*   **Recursos del proyecto de secuencia de comandos (Activadores/Web Apps):** Uso de `doGet` y `doPost` en aplicaciones web."
    }
  ]
}